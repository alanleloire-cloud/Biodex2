<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BioDex ‚Äî Prototype (Web)</title>
  <style>
    :root{
      --bg:#0b1220;
      --panel:#0f172a;
      --card:rgba(255,255,255,.06);
      --card2:rgba(255,255,255,.08);
      --text:#e6edf7;
      --muted:#9fb0c6;
      --border:rgba(255,255,255,.12);
      --shadow: 0 18px 50px rgba(0,0,0,.45);
      --r1:18px;
      --r2:22px;
      --r3:28px;
      --green:#22c55e;
      --blue:#38bdf8;
      --amber:#f59e0b;
      --red:#ef4444;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background: radial-gradient(1200px 600px at 20% -10%, rgba(56,189,248,.22), transparent 60%),
                  radial-gradient(900px 520px at 80% 0%, rgba(34,197,94,.18), transparent 55%),
                  radial-gradient(900px 520px at 50% 110%, rgba(245,158,11,.10), transparent 60%),
                  var(--bg);
      color:var(--text);
      min-height:100vh;
      display:grid;
      place-items:center;
      padding:24px;
    }

    .wrap{ display:grid; gap:18px; grid-template-columns: 380px; }

    .phone{
      width: 380px;
      border-radius: 44px;
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: var(--shadow);
      padding: 14px;
    }

    .screen{
      border-radius: 34px;
      background: linear-gradient(180deg, rgba(15,23,42,.92), rgba(15,23,42,.86));
      border: 1px solid rgba(255,255,255,.10);
      overflow:hidden;
      min-height: 760px;
      position:relative;
    }

    .statusbar{
      height: 44px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 0 16px;
      font-size: 13px;
      color: rgba(230,237,247,.9);
    }
    .dot{ width:6px; height:6px; border-radius:99px; background: rgba(230,237,247,.7); display:inline-block; margin-left:6px; }

    .app{
      padding: 8px 14px 90px;
    }

    .top{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding: 6px 2px 10px;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
    }
    .logo{
      width: 38px; height: 38px;
      border-radius: 16px;
      background: radial-gradient(circle at 25% 20%, rgba(34,197,94,.9), rgba(56,189,248,.35));
      display:grid;
      place-items:center;
      border: 1px solid rgba(255,255,255,.16);
      box-shadow: 0 10px 25px rgba(0,0,0,.35);
      font-weight: 900;
    }
    .title{ font-weight: 900; letter-spacing:-0.02em; }
    .subtitle{ font-size: 12px; color: var(--muted); margin-top:2px; }

    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding: 7px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.12);
      font-size: 12px;
      color: rgba(230,237,247,.95);
      white-space:nowrap;
    }

    .card{
      background: var(--card);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: var(--r3);
      padding: 14px;
    }

    .hero{
      background:
        radial-gradient(700px 320px at 20% 0%, rgba(34,197,94,.18), transparent 55%),
        radial-gradient(700px 320px at 85% 40%, rgba(56,189,248,.20), transparent 60%),
        rgba(255,255,255,.06);
      border-radius: var(--r3);
      border: 1px solid rgba(255,255,255,.12);
      padding: 14px;
    }

    .hero h1{ font-size: 18px; margin:0; letter-spacing:-0.02em; }
    .hero p{ margin:8px 0 0; font-size: 13px; color: var(--muted); line-height:1.45; }

    .btn{
      width: 100%;
      margin-top: 12px;
      border: 0;
      padding: 12px 14px;
      border-radius: 18px;
      font-weight: 800;
      cursor:pointer;
      color: #071021;
      background: linear-gradient(90deg, rgba(34,197,94,.95), rgba(56,189,248,.9));
      box-shadow: 0 12px 28px rgba(0,0,0,.35);
      transition: transform .08s ease;
    }
    .btn:active{ transform: translateY(1px); }

    .grid2{ display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:12px; }
    .mini{
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 18px;
      padding: 10px;
    }
    .k{ font-size: 11px; color: var(--muted); }
    .v{ font-size: 14px; font-weight: 900; margin-top:2px; }

    .row{ display:flex; align-items:center; justify-content:space-between; gap:10px; }

    .tabs{ display:flex; gap:8px; margin-top:12px; }
    .tab{
      flex:1;
      padding: 10px 10px;
      border-radius: 16px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
      color: rgba(230,237,247,.95);
      font-weight: 800;
      cursor:pointer;
    }
    .tab.active{ background: rgba(34,197,94,.18); border-color: rgba(34,197,94,.35); }

    .list{ display:grid; gap:10px; margin-top:12px; }

    .tag{
      display:inline-flex; align-items:center; gap:6px;
      font-size: 11px;
      padding: 6px 9px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: rgba(230,237,247,.92);
    }
    .tag.green{ border-color: rgba(34,197,94,.35); background: rgba(34,197,94,.16); }
    .tag.blue{ border-color: rgba(56,189,248,.35); background: rgba(56,189,248,.14); }
    .tag.red{ border-color: rgba(239,68,68,.40); background: rgba(239,68,68,.16); }

    /* Scan */
    .scanWrap{ padding: 10px 14px 90px; }
    .camera{
      height: 470px;
      border-radius: var(--r3);
      border: 1px solid rgba(255,255,255,.14);
      background:
        radial-gradient(500px 240px at 50% 10%, rgba(34,197,94,.16), transparent 60%),
        radial-gradient(520px 280px at 65% 65%, rgba(56,189,248,.14), transparent 60%),
        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="900" height="600"><defs><linearGradient id="g" x1="0" x2="0" y1="0" y2="1"><stop stop-color="%230b4" stop-opacity=".35"/><stop offset="1" stop-color="%230012" stop-opacity=".0"/></linearGradient></defs><rect width="100%" height="100%" fill="%23091422"/><g opacity=".65"><path d="M0 420 C 120 360, 240 520, 360 460 C 480 400, 600 520, 720 460 C 820 420, 880 500, 900 470 L900 600 L0 600 Z" fill="%230b2"/><path d="M0 460 C 140 410, 240 560, 390 500 C 540 440, 660 560, 780 510 C 850 480, 880 560, 900 540 L900 600 L0 600 Z" fill="%23092" opacity=".55"/></g><rect width="100%" height="100%" fill="url(%23g)"/></svg>') center/cover no-repeat;
      position:relative;
      overflow:hidden;
    }
    .scanBox{
      position:absolute;
      inset: 70px 36px 110px;
      border-radius: 26px;
      border: 2px dashed rgba(230,237,247,.55);
      background: rgba(0,0,0,.10);
      display:grid;
      place-items:center;
      text-align:center;
      padding: 12px;
    }
    .scanBox .hint{ font-size: 12px; color: rgba(230,237,247,.85); font-weight:800; }
    .scanBox .sub{ margin-top:6px; font-size: 12px; color: var(--muted); }
    .scanOrb{
      position:absolute;
      left:50%;
      bottom: 22px;
      transform: translateX(-50%);
      width: 74px; height: 74px;
      border-radius: 999px;
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.16);
      display:grid;
      place-items:center;
      cursor:pointer;
      box-shadow: 0 12px 30px rgba(0,0,0,.35);
    }
    .scanOrb::after{
      content:"";
      width: 58px; height: 58px;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(34,197,94,.95), rgba(56,189,248,.9));
      display:block;
      box-shadow: 0 10px 22px rgba(0,0,0,.35);
    }
    .scanTop{
      display:flex; align-items:center; justify-content:space-between;
      margin-bottom: 10px;
    }
    .back{
      width: 42px; height: 42px;
      border-radius: 16px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
      color: rgba(230,237,247,.95);
      cursor:pointer;
      display:grid;
      place-items:center;
      font-size: 18px;
    }

    .progress{
      margin-top: 12px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 16px;
      padding: 12px;
    }
    .bar{ height: 10px; border-radius: 999px; background: rgba(255,255,255,.08); overflow:hidden; border: 1px solid rgba(255,255,255,.10); }
    .bar > div{ height:100%; width: 0%; background: linear-gradient(90deg, rgba(34,197,94,.95), rgba(56,189,248,.9)); transition: width .25s ease; }

    /* Result */
    .resultHeader{ display:flex; align-items:flex-start; justify-content:space-between; gap:10px; }
    .species{ font-weight: 950; font-size: 18px; letter-spacing:-0.02em; }
    .latin{ margin-top:4px; font-size: 12px; color: var(--muted); font-style: italic; }
    .confidence{ font-size: 12px; color: rgba(230,237,247,.92); }

    .actions{ display:grid; gap:10px; margin-top:12px; }
    .btn2{
      width:100%;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: rgba(230,237,247,.95);
      padding: 12px 12px;
      border-radius: 18px;
      font-weight: 900;
      cursor:pointer;
    }
    .btn2.primary{
      background: rgba(239,68,68,.18);
      border-color: rgba(239,68,68,.35);
    }

    .note{
      font-size: 12px;
      color: var(--muted);
      line-height: 1.45;
      margin-top: 10px;
    }

    /* BioDex */
    .search{
      margin-top: 10px;
      display:flex;
      gap:10px;
    }
    .search input{
      flex:1;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      padding: 11px 12px;
      color: var(--text);
      outline:none;
      font-weight:700;
    }

    .gridStats{ display:grid; grid-template-columns: repeat(3, 1fr); gap:10px; margin-top: 12px; }
    .stat{ padding: 10px; border-radius: 18px; background: rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); }
    .stat .n{ font-weight: 950; font-size: 18px; }
    .stat .l{ font-size: 11px; color: var(--muted); margin-top: 2px; }

    .cards{ display:grid; gap:10px; margin-top: 12px; }
    .entry{
      display:flex; gap:10px; align-items:center;
      padding: 12px;
      border-radius: 22px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
    }
    .thumb{
      width: 56px; height: 56px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.14);
      background:
        radial-gradient(circle at 30% 25%, rgba(34,197,94,.30), rgba(56,189,248,.10)),
        rgba(255,255,255,.06);
      display:grid;
      place-items:center;
      font-size: 22px;
    }
    .entry .name{ font-weight: 950; }
    .entry .meta{ margin-top:3px; font-size: 12px; color: var(--muted); }

    /* Bottom nav */
    .nav{
      position:absolute;
      left: 12px;
      right: 12px;
      bottom: 12px;
      border-radius: 26px;
      background: rgba(15,23,42,.78);
      border: 1px solid rgba(255,255,255,.14);
      padding: 10px;
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
      backdrop-filter: blur(10px);
    }
    .nav button{
      border:0;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      color: rgba(230,237,247,.92);
      padding: 10px 8px;
      border-radius: 18px;
      font-weight: 900;
      cursor:pointer;
      font-size: 12px;
    }
    .nav button.active{
      background: rgba(34,197,94,.18);
      border-color: rgba(34,197,94,.35);
    }

    .toast{
      position:absolute;
      left: 14px;
      right: 14px;
      top: 58px;
      border-radius: 22px;
      padding: 12px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.35);
      backdrop-filter: blur(10px);
      display:none;
      gap:10px;
      align-items:flex-start;
      box-shadow: 0 18px 40px rgba(0,0,0,.35);
    }
    .toast .t{ font-weight:950; }
    .toast .m{ font-size:12px; color: rgba(230,237,247,.85); margin-top:2px; }
    .toast.show{ display:flex; }

    @media (max-width: 420px){
      .wrap{ grid-template-columns: 1fr; }
      .phone{ width: 100%; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="phone" aria-label="Prototype BioDex">
      <div class="screen">
        <div class="statusbar">
          <div>9:41</div>
          <div>‚óè‚óè‚óè <span class="dot"></span><span class="dot"></span></div>
        </div>

        <div class="toast" id="toast">
          <div style="width:34px;height:34px;border-radius:16px;background:rgba(239,68,68,.18);border:1px solid rgba(239,68,68,.35);display:grid;place-items:center;">!</div>
          <div>
            <div class="t" id="toastTitle">Info</div>
            <div class="m" id="toastMsg">Message</div>
          </div>
        </div>

        <!-- ACCUEIL -->
        <div class="app" id="view-home" hidden>
          <div class="top">
            <div class="brand">
              <div class="logo">BD</div>
              <div>
                <div class="title">Bonjour üëã</div>
                <div class="subtitle">Pr√™t √† explorer la biodiversit√© ?</div>
              </div>
            </div>
            <div class="pill">Niv <strong>5</strong> ‚Ä¢ 1 500 XP</div>
          </div>

          <div class="hero">
            <h1>Scanner une esp√®ce</h1>
            <p>Prends une photo : BioDex identifie et classe (commune / prot√©g√©e / invasive).</p>
            <button class="btn" id="goScan">Lancer le scan</button>

            <div class="grid2">
              <div class="mini">
                <div class="k">Aujourd‚Äôhui</div>
                <div class="v">1 scan</div>
              </div>
              <div class="mini">
                <div class="k">Objectif</div>
                <div class="v">Niv 6</div>
              </div>
            </div>
          </div>

          <div class="card" style="margin-top:12px;">
            <div class="row">
              <div>
                <div class="title">Mes derni√®res d√©couvertes</div>
                <div class="subtitle">Ajout√©es √† ton BioDex</div>
              </div>
              <button class="pill" id="goDex2" style="cursor:pointer;">Voir BioDex ‚Üí</button>
            </div>
            <div class="list">
              <div class="entry">
                <div class="thumb">ü¶ã</div>
                <div style="flex:1;">
                  <div class="name">Papillon cuivr√© commun</div>
                  <div class="meta">Faune ‚Ä¢ Esp√®ce commune</div>
                </div>
                <span class="tag green">Commune</span>
              </div>
              <div class="entry">
                <div class="thumb">üåº</div>
                <div style="flex:1;">
                  <div class="name">P√¢querette</div>
                  <div class="meta">Flore ‚Ä¢ Esp√®ce commune</div>
                </div>
                <span class="tag green">Commune</span>
              </div>
            </div>
          </div>

          <div class="card" style="margin-top:12px;">
            <div class="title">Qu√™te du jour</div>
            <p style="margin-top:6px; font-size:13px;">Signale <strong>1 esp√®ce invasive</strong> pr√®s de chez toi.</p>
            <div class="note">Exemples : herbe de la pampa, ambroisie, renou√©e du Japon‚Ä¶</div>
          </div>
        </div>

        <!-- SCAN -->
        <div class="scanWrap" id="view-scan" hidden>
          <div class="scanTop">
            <button class="back" id="backFromScan" aria-label="Retour">‚Üê</button>
            <div class="pill">Scan ‚Ä¢ Cam√©ra</div>
            <div style="width:42px;"></div>
          </div>

          <div class="camera" aria-label="Aper√ßu cam√©ra">
            <div class="scanBox">
              <div>
                <div class="hint">Cible : herbe de la pampa</div>
                <div class="sub">Cadre la plante dans la zone</div>
              </div>
            </div>
            <div class="scanOrb" id="doScan" title="Scanner"></div>
          </div>

          <div class="progress" id="progress" hidden>
            <div class="row">
              <div style="font-weight:950;">Identification‚Ä¶</div>
              <div class="pill" id="pct">0%</div>
            </div>
            <div class="bar" style="margin-top:10px;"><div id="bar"></div></div>
            <div class="note">BioDex analyse l‚Äôimage et estime le statut (commune / prot√©g√©e / invasive).</div>
          </div>
        </div>

        <!-- RESULTAT -->
        <div class="app" id="view-result" hidden>
          <div class="top">
            <button class="back" id="backFromResult" aria-label="Retour">‚Üê</button>
            <div class="pill">R√©sultat ‚Ä¢ Scan</div>
            <div style="width:42px;"></div>
          </div>

          <div class="card">
            <div class="resultHeader">
              <div>
                <div class="species">Herbe de la pampa</div>
                <div class="latin">Cortaderia selloana</div>
              </div>
              <div style="text-align:right;">
                <div class="confidence">Confiance</div>
                <div style="font-weight:950; font-size:18px;">92%</div>
              </div>
            </div>

            <div style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap;">
              <span class="tag red">Invasive</span>
              <span class="tag">Flore</span>
              <span class="tag">France</span>
            </div>

            <div class="note" style="margin-top:12px;">
              L‚Äôherbe de la pampa se propage rapidement et peut remplacer les plantes locales.
              BioDex peut aider √† rep√©rer les foyers pour faciliter l‚Äôaction sur le terrain.
            </div>
          </div>

          <div class="actions">
            <button class="btn2 primary" id="report">Signaler comme invasive</button>
            <button class="btn2" id="addDex">Ajouter au BioDex</button>
            <button class="btn2" id="seeMap">Voir sur la carte (prototype)</button>
          </div>

          <div class="card" style="margin-top:12px;">
            <div class="title">Conseils</div>
            <div class="note">√âvite de disperser des graines. Ne coupe pas si tu n‚Äôes pas √©quip√© : suis les recommandations locales.</div>
          </div>
        </div>

        <!-- BIODEX -->
        <div class="app" id="view-dex" hidden>
          <div class="top">
            <div class="brand">
              <div class="logo">üìó</div>
              <div>
                <div class="title">Mon BioDex</div>
                <div class="subtitle">Ta collection Faune & Flore</div>
              </div>
            </div>
            <div class="pill">Niv <strong>5</strong></div>
          </div>

          <div class="search">
            <input id="q" placeholder="Rechercher une esp√®ce‚Ä¶" />
          </div>

          <div class="gridStats">
            <div class="stat"><div class="n" id="nFaune">2</div><div class="l">Faune</div></div>
            <div class="stat"><div class="n" id="nFlore">2</div><div class="l">Flore</div></div>
            <div class="stat"><div class="n" id="nInv">0</div><div class="l">Invasives</div></div>
          </div>

          <div class="tabs">
            <button class="tab active" data-filter="all">Tous</button>
            <button class="tab" data-filter="faune">Faune</button>
            <button class="tab" data-filter="flore">Flore</button>
            <button class="tab" data-filter="invasive">Invasives</button>
          </div>

          <div class="cards" id="dexList"></div>

          <div class="card" style="margin-top:12px;">
            <div class="title">R√®gles BioDex</div>
            <div class="note">
              ‚Ä¢ <span class="tag green">Commune</span> : observation libre ‚Ä¢
              <span class="tag blue">Prot√©g√©e</span> : observe sans d√©ranger ‚Ä¢
              <span class="tag red">Invasive</span> : signalement recommand√©.
            </div>
          </div>
        </div>

        <!-- CARTE (placeholder) -->
        <div class="app" id="view-map" hidden>
          <div class="top">
            <button class="back" id="backFromMap" aria-label="Retour">‚Üê</button>
            <div class="pill">Carte ‚Ä¢ Prototype</div>
            <div style="width:42px;"></div>
          </div>
          <div class="card">
            <div class="title">Carte (maquette)</div>
            <div class="note">Dans la V1 : affichage des points / clusters d‚Äôinvasives. Ici, simple placeholder.</div>
          </div>
          <div class="list">
            <div class="entry">
              <div class="thumb">üìç</div>
              <div style="flex:1;">
                <div class="name">Foyer ‚ÄúHerbe de la pampa‚Äù</div>
                <div class="meta">3 signalements ‚Ä¢ 2 km</div>
              </div>
              <span class="tag red">Priorit√©</span>
            </div>
            <div class="entry">
              <div class="thumb">üìç</div>
              <div style="flex:1;">
                <div class="name">Zone sensible (esp√®ce prot√©g√©e)</div>
                <div class="meta">Acc√®s conseill√© ‚Ä¢ information</div>
              </div>
              <span class="tag blue">Info</span>
            </div>
          </div>
        </div>

        <!-- Bottom nav -->
        <div class="nav" role="navigation" aria-label="Navigation">
          <button id="navHome">Accueil</button>
          <button id="navScan">Scan</button>
          <button id="navDex">BioDex</button>
          <button id="navMap">Carte</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // --- Simple router
    const views = {
      home: document.getElementById('view-home'),
      scan: document.getElementById('view-scan'),
      result: document.getElementById('view-result'),
      dex: document.getElementById('view-dex'),
      map: document.getElementById('view-map'),
    };

    const navBtns = {
      home: document.getElementById('navHome'),
      scan: document.getElementById('navScan'),
      dex: document.getElementById('navDex'),
      map: document.getElementById('navMap'),
    };

    function setActiveNav(key){
      Object.entries(navBtns).forEach(([k, btn]) => {
        btn.classList.toggle('active', k === key);
      });
    }

    function showView(key){
      Object.values(views).forEach(v => v.hidden = true);
      views[key].hidden = false;
      if (key === 'result') setActiveNav('scan');
      else setActiveNav(key);
    }

    // --- Toast
    const toast = document.getElementById('toast');
    const toastTitle = document.getElementById('toastTitle');
    const toastMsg = document.getElementById('toastMsg');

    let toastTimer;
    function showToast(title, msg){
      toastTitle.textContent = title;
      toastMsg.textContent = msg;
      toast.classList.add('show');
      clearTimeout(toastTimer);
      toastTimer = setTimeout(() => toast.classList.remove('show'), 2400);
    }

    // --- Demo data
    let dex = [
      { icon:'ü¶ã', name:'Papillon cuivr√© commun', latin:'Lycaena phlaeas', type:'faune', status:'commune' },
      { icon:'ü¶î', name:'H√©risson europ√©en', latin:'Erinaceus europaeus', type:'faune', status:'prot√©g√©e' },
      { icon:'üåº', name:'P√¢querette', latin:'Bellis perennis', type:'flore', status:'commune' },
      { icon:'ü™≤', name:'Coccinelle √† deux points', latin:'Adalia bipunctata', type:'faune', status:'commune' },
    ];

    function statusTag(status){
      if (status === 'invasive') return '<span class="tag red">Invasive</span>';
      if (status === 'prot√©g√©e') return '<span class="tag blue">Prot√©g√©e</span>';
      return '<span class="tag green">Commune</span>';
    }

    function typeLabel(t){
      return t === 'faune' ? 'Faune' : 'Flore';
    }

    function updateStats(){
      const faune = dex.filter(x => x.type === 'faune').length;
      const flore = dex.filter(x => x.type === 'flore').length;
      const inv = dex.filter(x => x.status === 'invasive').length;
      document.getElementById('nFaune').textContent = faune;
      document.getElementById('nFlore').textContent = flore;
      document.getElementById('nInv').textContent = inv;
    }

    const dexList = document.getElementById('dexList');
    const q = document.getElementById('q');

    let filter = 'all';

    function renderDex(){
      updateStats();
      const query = (q.value || '').toLowerCase().trim();
      const items = dex.filter(item => {
        const matchesQuery = !query || item.name.toLowerCase().includes(query) || item.latin.toLowerCase().includes(query);
        const matchesFilter =
          filter === 'all' ? true :
          filter === 'invasive' ? item.status === 'invasive' :
          item.type === filter;
        return matchesQuery && matchesFilter;
      });

      dexList.innerHTML = items.map(item => `
        <div class="entry">
          <div class="thumb">${item.icon}</div>
          <div style="flex:1;">
            <div class="name">${item.name}</div>
            <div class="meta">${item.latin} ‚Ä¢ ${typeLabel(item.type)}</div>
          </div>
          ${statusTag(item.status)}
        </div>
      `).join('') || `
        <div class="card">
          <div class="title">Aucun r√©sultat</div>
          <div class="note">Essaie un autre mot-cl√© ou change le filtre.</div>
        </div>
      `;
    }

    // --- Home buttons
    document.getElementById('goScan').addEventListener('click', () => showView('scan'));
    document.getElementById('goDex2').addEventListener('click', () => { showView('dex'); renderDex(); });

    // --- Nav buttons
    navBtns.home.addEventListener('click', () => showView('home'));
    navBtns.scan.addEventListener('click', () => showView('scan'));
    navBtns.dex.addEventListener('click', () => { showView('dex'); renderDex(); });
    navBtns.map.addEventListener('click', () => showView('map'));

    // --- Back buttons
    document.getElementById('backFromScan').addEventListener('click', () => showView('home'));
    document.getElementById('backFromResult').addEventListener('click', () => showView('scan'));
    document.getElementById('backFromMap').addEventListener('click', () => showView('home'));

    // --- Scan simulation
    const progress = document.getElementById('progress');
    const bar = document.getElementById('bar');
    const pct = document.getElementById('pct');

    let scanning = false;
    document.getElementById('doScan').addEventListener('click', () => {
      if (scanning) return;
      scanning = true;
      progress.hidden = false;
      let p = 0;
      bar.style.width = '0%';
      pct.textContent = '0%';

      const timer = setInterval(() => {
        p += Math.floor(8 + Math.random()*14);
        if (p > 100) p = 100;
        bar.style.width = p + '%';
        pct.textContent = p + '%';
        if (p >= 100){
          clearInterval(timer);
          setTimeout(() => {
            scanning = false;
            progress.hidden = true;
            showView('result');
          }, 300);
        }
      }, 220);
    });

    // --- Result actions
    document.getElementById('report').addEventListener('click', () => {
      showToast('Signalement envoy√©', 'Merci ! Le foyer ‚ÄúHerbe de la pampa‚Äù a √©t√© enregistr√©.');
    });

    document.getElementById('seeMap').addEventListener('click', () => {
      showView('map');
      showToast('Carte', 'Prototype : visualisation simplifi√©e des foyers.');
    });

    document.getElementById('addDex').addEventListener('click', () => {
      const exists = dex.some(x => x.name === 'Herbe de la pampa');
      if (!exists){
        dex.unshift({ icon:'üåæ', name:'Herbe de la pampa', latin:'Cortaderia selloana', type:'flore', status:'invasive' });
      }
      showToast('Ajout√© au BioDex', 'Entr√©e ajout√©e : Herbe de la pampa (Invasive).');
      showView('dex');
      renderDex();
    });

    // --- Dex filters
    document.querySelectorAll('.tab').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        filter = btn.getAttribute('data-filter');
        renderDex();
      });
    });

    q.addEventListener('input', renderDex);

    // --- Init
    showView('home');
    setActiveNav('home');
  </script>
</body>
</html>
